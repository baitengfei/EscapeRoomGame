{"version":3,"sources":["file:///Users/baitengfei/code/EscapeRoom/EscapeRoomMVP/assets/Scripts/Manager/LoadingManager.ts"],"names":["_decorator","assetManager","director","Sprite","Component","GameData","ccclass","property","LoadingManager","type","readyLoadSubPackage","currentPackageIndex","bLoadFinish","onLoad","start","preloadScene","console","log","ins","LoadData","mProgress","fillRange","LoadSubPackages","self","subPackageName","LoadSubPackage","resName","loadBundle","err","length","LoadFinish","loadScene"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAGSA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,Y,OAAAA,Y;AAAcC,MAAAA,Q,OAAAA,Q;AAAUC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,S,OAAAA,S;;AAC5CC,MAAAA,Q,iBAAAA,Q;;;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBP,U;;gCAGjBQ,c,WADZF,OAAO,CAAC,gBAAD,C,UAOHC,QAAQ,CAAC;AAACE,QAAAA,IAAI,EAACN;AAAN,OAAD,C,2BAPb,MACaK,cADb,SACoCJ,SADpC,CAC8C;AAAA;AAAA;AAC1C;AACA;AAF0C,eAG1CM,mBAH0C,GAGV,CAAC,QAAD,EAAW,IAAX,EAAiB,OAAjB,EAA0B,IAA1B,EAAgC,IAAhC,EAAsC,IAAtC,EAA4C,IAA5C,CAHU;AAAA,eAI1CC,mBAJ0C,GAIb,CAJa;;AAAA;;AAAA,eA8D1CC,WA9D0C,GA8DpB,KA9DoB;AAAA;;AAS1CC,QAAAA,MAAM,GAAG,CAER;;AAEDC,QAAAA,KAAK,GAAG;AACJZ,UAAAA,QAAQ,CAACa,YAAT,CAAsB,MAAtB,EAA8B,MAAI;AAC9BC,YAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACH,WAFD,EADI,CAKJ;;AACA;AAAA;AAAA,oCAASC,GAAT,GAAeC,QAAf;AAEA,eAAKC,SAAL,CAAeC,SAAf,GAA2B,CAA3B;AACA,eAAKC,eAAL;AAEH;;AAEDA,QAAAA,eAAe,GAAG;AACd,cAAIC,IAAI,GAAG,IAAX;AACAA,UAAAA,IAAI,CAACZ,mBAAL,GAA2B,CAA3B;AACA,cAAIa,cAAc,GAAGD,IAAI,CAACb,mBAAL,CAAyBa,IAAI,CAACZ,mBAA9B,CAArB;AACAY,UAAAA,IAAI,CAACE,cAAL,CAAoBD,cAApB;AAEH;;AAEDC,QAAAA,cAAc,CAACC,OAAD,EAAkB;AAC5BzB,UAAAA,YAAY,CAAC0B,UAAb,CAAwBD,OAAxB,EAAkCE,GAAD,IAAc;AAC3C,gBAAIA,GAAJ,EAAS;AACL;AACAZ,cAAAA,OAAO,CAACC,GAAR,CAAY,YAAYS,OAAxB;AACH,aAHD,MAII;AACA;AACAV,cAAAA,OAAO,CAACC,GAAR,CAAY,YAAYS,OAAxB;AACH;;AAED,iBAAKf,mBAAL,IAA4B,CAA5B;AAEA,iBAAKS,SAAL,CAAeC,SAAf,GAA2B,KAAKV,mBAAL,GAAyB,KAAKD,mBAAL,CAAyBmB,MAA7E;;AAEA,gBAAI,KAAKlB,mBAAL,GAA2B,KAAKD,mBAAL,CAAyBmB,MAAxD,EACA;AACI,kBAAIL,cAAc,GAAG,KAAKd,mBAAL,CAAyB,KAAKC,mBAA9B,CAArB;AACA,mBAAKc,cAAL,CAAoBD,cAApB;AACH,aAJD,MAKK;AACD;AACA,mBAAKM,UAAL;AACH;AACJ,WAvBD;AAyBH;;AAGDA,QAAAA,UAAU,GAAG;AACT,eAAKV,SAAL,CAAeC,SAAf,GAA2B,CAA3B;AACA,eAAKT,WAAL,GAAmB,IAAnB;AACAV,UAAAA,QAAQ,CAAC6B,SAAT,CAAmB,MAAnB;AAEH;;AApEyC,O","sourcesContent":["\n// 加载游戏资源，显示进度条。加载完成后进入场景main\n\nimport { _decorator, assetManager, director, Sprite, Component } from \"cc\";\nimport { GameData } from \"../Data/GameData\";\n\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"LoadingManager\")\nexport class LoadingManager extends Component {\n    //载入子包（文件位置: Res/SubPackages/..）\n    //需要动态加载的资源都应该放在该子包文件夹下\n    readyLoadSubPackage:string[] =  [\"Config\", \"UI\", \"Sound\", \"S1\", \"S2\", \"S3\", \"S4\"];\n    currentPackageIndex:number = 0;\n\n    @property({type:Sprite})\n    mProgress:Sprite;\n\n    onLoad() {\n\n    }\n\n    start() {\n        director.preloadScene(\"Main\", ()=>{\n            console.log(\"预加载主场景\");\n        });\n\n        // 载入数据\n        GameData.ins().LoadData();\n\n        this.mProgress.fillRange = 0;\n        this.LoadSubPackages();\n    \n    }\n\n    LoadSubPackages() {\n        let self = this;\n        self.currentPackageIndex = 0;\n        let subPackageName = self.readyLoadSubPackage[self.currentPackageIndex];\n        self.LoadSubPackage(subPackageName);\n    \n    }\n\n    LoadSubPackage(resName: string) {\n        assetManager.loadBundle(resName, (err: any) => {\n            if (err) {\n                // 载入失败，暂时不用管，网页没有此方法会载入失败\n                console.log(\"加载子包失败：\" + resName);\n            }\n            else{\n                // 载入成功\n                console.log(\"加载子包成功：\" + resName);\n            }\n\n            this.currentPackageIndex += 1;\n\n            this.mProgress.fillRange = this.currentPackageIndex/this.readyLoadSubPackage.length;\n\n            if (this.currentPackageIndex < this.readyLoadSubPackage.length)\n            {\n                let subPackageName = this.readyLoadSubPackage[this.currentPackageIndex];\n                this.LoadSubPackage(subPackageName);\n            }\n            else {\n                // 子包全部载入完毕\n                this.LoadFinish();\n            }\n        });       \n    \n    }\n\n    bLoadFinish:boolean = false;\n    LoadFinish() {\n        this.mProgress.fillRange = 1;\n        this.bLoadFinish = true;\n        director.loadScene(\"Main\");\n        \n    }\n\n}\n"]}