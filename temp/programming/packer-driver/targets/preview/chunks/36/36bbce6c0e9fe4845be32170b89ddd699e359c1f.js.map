{"version":3,"sources":["file:///Users/baitengfei/code/EscapeRoom/EscapeRoomMVP/assets/Scripts/Config/ConfigLoader.ts"],"names":["_decorator","Component","TextAsset","game","CfgUtil","ccclass","property","ConfigLoader","_sendOver","onLoad","addPersistRootNode","node","loadCfgs","start","console","log","_cfgsInit","cfgDic","cfgs","forEach","v","name","text","cfgMap","k","content","listItems","mapArr","split","listPropertys","i","length","arr","obj","index","arrName","trim","parseInt","toString","push","ins","loadCfgOver"],"mappings":"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","sourcesContent":["//加载和解析游戏的配置文件\nimport { CfgUtil } from './CfgUtil';\nimport { _decorator, Component, TextAsset, game } from 'cc';\nconst { ccclass, property } = _decorator;\n\n@ccclass('ConfigLoader')\nexport class ConfigLoader extends Component {\n\n    @property(TextAsset)\n    cfgs:TextAsset[]=[];\n\n    onLoad() {\n        game.addPersistRootNode(this.node);\n        this.loadCfgs();\n    }\n\n    start() {\n        \n    }\n\n    //延迟加载\n    loadCfgs() {\n        console.log(\"开始读配置 \");\n        this._cfgsInit();\n    }\n\n    _sendOver:boolean=false;\n    //初始化配置\n    _cfgsInit() {\n        if (this._sendOver) {\n            return;\n        }\n        var cfgDic:any = {};\n        //从预设引用 读取所有 配置数据\n        this.cfgs.forEach(v => {\n            cfgDic[v.name] = v.text;\n        });\n\n        var cfgMap:any = {};\n        //每个配置文件生成 id为索引的key\n        for (let k in cfgDic) {\n            if (!cfgMap[k]) {\n                cfgMap[k] = {};\n\n                var content = cfgDic[k];\n                let listItems:any[] = [];\n                var mapArr = content.split(\"\\n\")  \n                let listPropertys:string[] = [];\n                listPropertys = mapArr[1].split(\"\\t\");\n                for(var i = 2; i < mapArr.length;i++) {\n                    var arr = mapArr[i].split(\"\\t\")\n                    if(arr != null && mapArr[i] != \"\") {\n                        let obj:any = {}; \n                        for (let index = 0; index < arr.length; index++) {\n                            let arrName = listPropertys[index].trim();\n                            if (arrName == \"id\") {\n                                obj[arrName] = parseInt(arr[index]);\n                            }\n                            else {\n                                obj[arrName] = arr[index].toString().trim();\n                            }\n                        }\n                        listItems.push(obj);\n                    }\n                }\n                cfgMap[k] = listItems;\n            }\n        }\n        CfgUtil.ins().loadCfgOver(cfgMap);\n        this._sendOver = true;\n\n        console.log(\"配置读取完毕\");\n    }\n}\n"]}