{"version":3,"sources":["file:///Users/baitengfei/code/EscapeRoom/EscapeRoomMVP/assets/Scripts/Manager/UIManager.ts"],"names":["_decorator","Component","game","Node","assetManager","Prefab","instantiate","UIBase","CfgUtil","ccclass","property","UIType","UIRootType","UIManager","UINode","UINodeList","bInit","UIMap","listTips","tipsPrefab","onLoad","Instance","addPersistRootNode","node","init","canvas","getChildByName","typeList","length","k","nodeName","push","name","getUIParentNode","type","index","info","getUICfg","uiEnum","cfg","ins","getUIComponent","Show","uiBase","getComponent","refreshBase","openUI","args","active","setSiblingIndex","bCreate","path","bundleName","bundle","getBundle","load","error","prefabAsset","uiNode","ui","console","parent","bDestroyMode","onStart","closeUI","preLoadUI","preload","destroy","closeAllUI","log","ShowTips","content","Tips","prefab","InstanceTips","pNodeName","self","scheduleOnce","splice"],"mappings":"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","sourcesContent":["import { _decorator, Component, game, Node, assetManager, Prefab, instantiate } from \"cc\";\nimport { UIBase } from \"../Base/UIBase\";\nimport { CfgUtil } from \"../Config/CfgUtil\";\n\nconst { ccclass, property } = _decorator;\n\n// UI 类型\nexport enum UIType {\n    Main = 1,\n    Game,\n    Tips,\n    Bag,\n    Dialogue,\n    Pause,\n    Item_PC,\n    Item_Phone,\n    Item_Watch,\n    Win,\n    \n\n    Max\n}\n\nvar UIRootType:string[] = [\"UIMain\", \"UIAlert\", \"UITip\"];\n\n@ccclass('UIManager')\nexport class UIManager extends Component {\n    static Instance:UIManager = null!;\n\n    UINode:Node|null = null!;\n    @property(Node)\n    canvas:Node|null = null;\n\n    UINodeList:any[] = [];\n\n    bInit:boolean = false;\n    UIMap:any = {};\n\n    onLoad() {\n        UIManager.Instance = this;\n        game.addPersistRootNode(this.node);\n    \n    }\n\n    init() {\n        if (this.bInit)\n        {\n            return;\n        }\n        if (!this.UINode) {\n            if (this.canvas) {\n                this.UINode = this.canvas.getChildByName(\"UINode\");\n                if (this.UINode) {\n                    var typeList = UIRootType;\n                    this.UINodeList.length = 0;\n                    for (var k in typeList) {\n                        let nodeName = typeList[k];\n                        this.UINodeList.push({name:nodeName, node:this.UINode.getChildByName(nodeName)});\n                    }\n                }\n    \n                this.bInit = true;\n            }\n        }\n    }\n\n    getUIParentNode(type:string) {\n        for (let index = 0; index < this.UINodeList.length; index++) {\n            let info = this.UINodeList[index];\n            if (info.name == type) {\n                return info.node;\n            }\n        }\n\n        return null;\n    }\n\n    getUICfg(uiEnum) {\n        var cfg = CfgUtil.ins().getUICfg(uiEnum);\n        return cfg;\n    }\n\n    getUIComponent(type:UIType) {\n        if (this.UIMap[type] == null)\n        {\n            return null;\n        }\n        if (this.UIMap[type].Show) \n        {\n            if (this.UIMap[type].node != null) {\n                var uiBase:UIBase = this.UIMap[type].node.getComponent(UIBase);\n                if (uiBase && typeof (uiBase.refreshBase) == \"function\") {\n                    return uiBase;\n                }\n            }\n        }\n        return null;\n    }\n\n    openUI(type:UIType, args:any = null) {\n        if (!this.bInit) {\n            this.init();\n        }\n        if (this.UIMap[type] == null)\n        {\n            this.UIMap[type] = {};\n        }\n        if (this.UIMap[type].Show) \n        {\n            if (this.UIMap[type].node != null) {\n                this.UIMap[type].node.active = true;\n                this.UIMap[type].node.setSiblingIndex(100);\n                var uiBase:UIBase = this.UIMap[type].node.getComponent(UIBase);\n                if (uiBase && typeof (uiBase.refreshBase) == \"function\") {\n                    uiBase.refreshBase(args);\n                }\n            }\n            return;\n        }\n        this.UIMap[type].Show = true;\n        if (this.UIMap[type].node != null) {\n            this.UIMap[type].node.active = true;\n            this.UIMap[type].node.setSiblingIndex(100);\n            var uiBase:UIBase = this.UIMap[type].node.getComponent(UIBase);\n            if (uiBase && typeof (uiBase.refreshBase) == \"function\") {\n                uiBase.refreshBase(args);\n            }\n        }\n        else {\n            if (this.UIMap[type].bCreate) \n            {\n                return;\n            }\n            this.UIMap[type].bCreate = true;\n            var cfg:any = this.getUICfg(type);\n            var path = cfg.name;\n            let bundleName = \"UI\";\n            let bundle = assetManager.getBundle(bundleName);\n            if (cfg && bundle != null) {\n                bundle.load(path, Prefab, (error, prefabAsset:Prefab) => {\n                    if (!this.UIMap[type].Show)\n                    {\n                        //console.log(\"UI已关闭\", type);\n                        this.UIMap[type].bCreate = false;\n                        return;\n                    }\n                    var uiNode:Node = instantiate(prefabAsset);\n                    //console.log(\"UI实例化\", type, \",\", uiNode);\n                    var ui:UIBase|null = uiNode.getComponent(UIBase);\n                    if (ui == null) {\n                        console.error('该UI未挂脚本', uiNode.name);\n                    }\n                    uiNode.active = true;\n                    uiNode.setSiblingIndex(100);\n                    uiNode.parent = this.getUIParentNode(cfg.type);\n\n                    // this.UIMap[type] = {};\n                    this.UIMap[type].node = uiNode;\n\n                    //console.log(\"打开界面\",type);\n                    \n                    if (ui) {\n                        ui.bDestroyMode = false;\n                        ui.type = type;\n                        if (typeof (ui.onStart) == \"function\") {\n                            ui.onStart();\n                        }\n                        if (typeof (ui.refreshBase) == \"function\") {\n                            ui.refreshBase(args);\n                        }\n                        if (!this.UIMap[type].Show)\n                        {\n                            uiNode.active = false;\n                            this.closeUI(type);\n                        }\n                    }\n                });\n            }\n            else {\n                console.error(\" 没有此UI 配置\", type);\n            }\n        }\n    }\n\n    preLoadUI(type:UIType) {\n        var cfg:any = this.getUICfg(type);\n        var path = cfg.name;\n        let bundleName = \"UI\";\n        let bundle = assetManager.getBundle(bundleName);\n        if (bundle != null) {\n            bundle.preload(path, Prefab);\n        }\n    }\n\n    closeUI(type:UIType) {\n        if (this.UIMap[type] != null)\n        {\n            this.UIMap[type].Show = false;\n            var node:Node = this.UIMap[type].node;\n            if (node != null) {\n                var uiBase:UIBase|null = node.getComponent(UIBase);\n                if (uiBase != null && uiBase.bDestroyMode)\n                {\n                    node.destroy();\n                    this.UIMap[type] = null;\n                }\n                else\n                {\n                    node.active = false;\n                    //console.log(\"UI关闭了\",node.name,\",\",type);\n                }\n            }\n        }   \n    }\n\n    //关闭所有UI\n    closeAllUI() {\n        console.log(\"关闭所有UI\");\n        for (let k in this.UIMap) {\n            if (this.UIMap[k] != null)\n            {\n                this.UIMap[k].Show = false;\n                var node:Node = this.UIMap[k].node;\n                if (node != null) {\n                    var uiBase:UIBase|null = node.getComponent(UIBase);\n                    if (uiBase != null && uiBase.bDestroyMode)\n                    {\n                        node.destroy();\n                        this.UIMap[k] = null;\n                    }\n                    else\n                    {\n                        node.active = false;\n                        console.log(\"UI关闭了\",node.name,\",\",k);\n                    }\n                }\n            }  \n        }\n    }\n\n    listTips:string[] = [];\n    tipsPrefab:Prefab|null = null;\n    ShowTips(content:string) {\n        //console.log(\"准备提示：\" + content);\n        if (this.listTips.length <= 0)\n        {\n            this.listTips.push(content);\n\n            if (this.tipsPrefab == null)\n            {\n                var cfg:any = this.getUICfg(UIType.Tips);\n                var path = cfg.name;\n                let bundle = assetManager.getBundle(\"UI\");\n                if (cfg && bundle != null) {\n                    bundle.load(path, Prefab, (error, prefab:Prefab) => {\n                        this.tipsPrefab = prefab;\n                        this.InstanceTips();\n                    });\n                }\n            }\n            else    \n            {\n                this.InstanceTips();\n            }\n        }\n        else\n        {\n            this.listTips.push(content);\n        }\n    }\n\n    InstanceTips() {\n        if (this.listTips.length <= 0)\n        {\n            return;\n        }\n\n        let content:string = \"\";\n        for (let k in this.listTips) {\n            content = this.listTips[k];\n            break;\n        }\n\n        if (this.tipsPrefab == null) {\n            return;\n        }\n        var node = instantiate(this.tipsPrefab);\n        if (node == null) {\n            return;\n        }\n        var ui:UIBase|null = node.getComponent(UIBase);\n        if (ui == null) {\n            console.error('该UI未挂脚本');\n        }\n\n        var pNodeName = \"UITip\";\n        node.parent = this.getUIParentNode(pNodeName);\n\n        if (ui) {\n            ui.bDestroyMode = true;\n            ui.type = UIType.Tips;\n            if (typeof (ui.onStart) == \"function\") {\n                ui.onStart();\n            }\n            if (typeof (ui.refreshBase) == \"function\") {\n                ui.refreshBase(content);\n            }\n\n            let self = this;\n            this.scheduleOnce(function() {\n                self.listTips.splice(0, 1);\n                self.InstanceTips();\n            }, 0.5);\n        }\n    }\n\n}\n"]}